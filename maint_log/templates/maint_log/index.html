<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Vehicle Maintenance Logbook</title>
	<script src="https://unpkg.com/vue@3"></script>
	<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/tachyons@4.12.0/css/tachyons.min.css"/>
</head>
<body class="bg-black-30 pa3 avenir">
    {% if request.user.is_authenticated %}
    <h1>User <i>IS</i> Authenticated</h1>
    {% else %}
    <h1 class="red">User <i>NOT</i> Authenticated</h1>
    {% endif %}
	<div id="app">
		{% csrf_token %}
		<h1>Vehicle Maintenance Logbook</h1>
		<form @submit.prevent="addMaintenanceLog">
			<label for="new-maintenance">Name</label>
			<input v-model="newMaintenanceName" type="text" id="new-maintenance">
            <br>
            <label for="new-maintenance">Date</label>
			<input v-model="newMaintenanceDate" type="date" id="new-maintenance" min="1940-01-01">
            <br>
            <label for="new-maintenance">Mileage</label>
			<input v-model="newMaintenanceMileage" type="text" id="new-maintenance">
            <br>
            <label for="new-maintenance">Notes</label>
			<input v-model="newMaintenanceNotes" type="text" id="new-maintenance">
            <br>
			<input type="submit" value="Add Maintenance">
		</form>
		<ul>
			<li v-for="maintenanceLog in maintenanceLogs">
                [[ maintenanceLog.name ]]
                [[ maintenanceLog.date ]]
                [[ maintenanceLog.mileage ]]
                [[ maintenanceLog.notes ]]
            </li>
		</ul>
	</div>
	<script>
		const App = {
			data () {
				return {
					maintenanceLogs: [],
					newMaintenanceName: '',
					newMaintenanceDate: '',
					newMaintenanceMileage: '',
					newMaintenanceNotes: '',
					csrf_token: ''
				}
			},

			delimiters: ['[[', ']]'],

			created () {
				this.getMaintenanceLogs()
			},

			mounted () {
				const input = document.querySelector('input[name="csrfmiddlewaretoken"]')
				this.csrf_token = input.value
			},

			methods: {
				getMaintenanceLogs () {
					axios({
						method: 'get',
						url: '/get-maintenance-logs'
					}).then(res => {
						console.log(res.data)
						this.maintenanceLogs = res.data.maintenance_items
					})
				},

				addMaintenanceLog () {
					axios({
						method: 'post',
						url: '/add-maintenance-log/',
						data: {
							name: this.newMaintenanceName,
							date: this.newMaintenanceDate,
							mileage: this.newMaintenanceMileage,
							notes: this.newMaintenanceNotes,
						},
						headers: {
							'X-CSRFToken': this.csrf_token
						}
					}).then(res => this.getMaintenanceLogs())
					this.newMaintenance = ''
				}
			}
		}
		const app = Vue.createApp(App)
		app.mount('#app')
	</script>
</body>
</html>